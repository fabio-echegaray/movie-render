# Documentation - Table of contents

* [Basic usage (quick start)](#quick-start)
* [Configuration options](#configuration-options)
    * [Render movie](#render-movie)
    * [Render panel](#render-panel)
    * [Trackmate data](#trackmate-data-section)


# Quick start

Using the system is simple!

1- Create a configuration file.
Add section header "DATA".
Include path (relative or absolute) to the image file that was recorded from the microscope.
Add constraints to the frames that will be parsed by the system, or the number of channels.
Include also parameter overriding data.

#### example.cfg

```
[DATA]
image = example.ome.tif
frame = all
channel = [0, 1]
override_dt = 10
```

In this configuration, the data file example.ome.tif is specified by a path relative from the location of example.cfg.
Then, the section is restricting channels 1 & 2 only, but allowing all frames to be parsed.
Finally, it is overriding the sampling time to 10 seconds and the objective magnitude to 60X.

We want to render a movie.
Then, we should add a subsequent header named "MOVIE".
Add the movie definitions as follows:

#### example.cfg - movie definition

```
[MOVIE]
title = My Title
description = Lorem Ipsum.
fps = 10
layout = twoch
zstack = all-max
filename = example.mp4
```

In this example, a movie with the name example.mp4 will be generated by rendering the two available channels using the
`twoch` layout.
The movie will max-project all the images in the z-stack as established in the `zstack = all-max` configuration line.

Finally run in the terminal

```commandline
$ fileops-render example.cfg
```

# Configuration options

For general sections and parameters of the configuration file, please refer to
the [FileOps](https://github.com/fabio-echegaray/fileops) package.
package.
Movie-render depends on [FileOps](https://github.com/fabio-echegaray/fileops) package.
![dependencies.svg](figs%2Fdependencies.svg)

## Render movie plugin

Header "MOVIE".
If several movies are needed to be rendered from the same configuration file, separate every section with a name MOVIE
followed by a dash and a correlative number.
E.g. MOVIE-1, MOVIE-2, and so on.

The supported parameters to render a movie from a configuration file are as follows:

- `title`: a title that is going to be rendered in the frames of the movie.
- `description`: an internal parameter to keep track of the description of what the movie is about.
- `fps`: frames per second that the movie will be rendered with.
- `layout`: specifies the layout of the movie when the data has several channels or when many z-slices are meant to be
  shown in a single frame.
  Current options are:
    - `two-comp`: render two channels on one composite image.
    - `two-ch`: renders two channels side by side.
    - `two-col`: renders all available channels in two columns by N rows.
    - `z-n-col`: renders all available z-stacks of the first channel
      (if you want a different channel, you would need to select it with the channel argument) in N columns.
- `zstack`: indicates the renderer how many images it should incorporate from the z-stack.
  Possible options are to select one image from the z-stack or to project a subset of them into a single image when used
  im combination with `zstack_fn`.
  To select a single z-stack, just specify the number of the slice (starting from zero).
  If the user only wants to specify a projection and not a subset of z values, this parameter can take up a string value
  as if it was given to `zstack_fn` directly.
- `zstack_fn`: informs what to do with the z-stack in case the recorded data has this dimension and the user would like
  to apply a transform on the subset specified by `zstack`.
  To project the stack data onto a single image, the following options are currently available:
    - `all-max`: uses max projection.
    - `all-min`: uses min of all images, pixel-wise.
    - `all-sum`: uses sum of all images.
    - `all-std`: uses standard deviation of the images.
    - `all-mean`,`all-avg`, : uses average of all images.
    - `all-median`, : uses std projection.
- `roi`: Specifies the file of ROIs that the processing will use.
- `scalebar`: Set the scalebar size to the specified value in micrometers.
  If no number is specified, no scalebar will be rendered.
- `bitrate`: Set the bitrate of the movie in a format compatible with ffmpeg.
- `filename`: output name of the movie file.
- `overlays`: a list of all overlays to be included in the rendered movie.
  The overlays have to be defined using an OVERLAY section, and be posteriorly included in this definition by specifying
  their IDs.
  If several channels are being rendered, the overlay will apply to all different channels in the array.
- `include_tracks`: set to yes or true if you want to include Trackmate data (defined in Trackmate section) as an
  overlay to this movie.

## Render panel

Header "PANEL".

The supported parameters to render a panel are:

- `title`: a title that is going to be rendered on top of the array of images in the panel.
- `description`: an internal parameter to keep track of the description of what the render is about.
  This gets included in the metadata of the pdf file.
- `author`: provides author information to inform who this plot is attributed to.
  Copyright information goes into the metadata of the pdf file.
- `rows`: specifies the variable to put in the rows of the layout.
- `columns`: specifies the variable that goes on the columns of the layout.
- `max_columns`: specifies the maximum number of columns in the layout.
- `max_plots_per_page`: specifies how many plots are allowed per page in the layout.
- `width`: specifies the width (in inches) of every plot n the layout.
  Whichever parameter is set, the layout will preserve aspect ratio.
- `height`: specifies the length (in inches) of every plot in the array.
  Whichever parameter is set, the layout will preserve aspect ratio.
- `layout`: specifies the layout of the movie when the data has several channels or when many z-slices are meant to be
  shown in a single frame.
  Current options are:
    - `z-array`: every image in the array corresponds to a z-stack.
      New pages account for different time points.
    - `time-array`: images in the array represent a different timepoint.
      Stacks are aggregated using a projection that can be defined in `zstack_fn`.
- `zstack`: indicates the renderer how many images it should incorporate from the z-stack.
  Possible options are to select one image from the z-stack or to project a subset of them into a single image when used
  im combination with `zstack_fn`.
  To select a single z-stack, just specify the number of the slice (starting from zero).
- `multipage`: if true, the definition of rows in the plot (e.g., the different channels of the render) will
  become different pages of the pdf instead.
  When multipage is on, the constraint on maximum column number has no effect.
- `fontsize`: dictates the size of the font (in pt) in which all text of overlays is written.
- `scalebar`: sets the length of the scalebar in microns if a scalebar shall be drawn.
  If no number is specified, the scalebar will not be rendered.
- `scalebar_thickness`: sets the thickness of the scalebar in points.
- `overlays`: a list of all overlays to be included in the panel.
  The overlays have to be defined using an OVERLAY section, and be posteriorly included in this definition by specifying
  their IDs.

## Trackmate data section
Trackmate data can be made available to the rendering of a movie.
The relevant parameters for this section are:
- `path`: path of where the Trackmate file is located.
